=== Iteration 1 - S1 - 2026-02-02 ===
Status: COMPLETE
Learnings:
- Payload CMS 3.74.0 and all required packages installed successfully
- Peer dependency warning: @payloadcms/next and @payloadcms/ui require Next.js ^15.4.10 or >=16.1.1, but we have 16.0.10. This may need addressing in future stories if compatibility issues arise.
- Adding "type": "module" to package.json works with existing Next.js setup
- All packages installed: payload, @payloadcms/db-postgres, @payloadcms/next, @payloadcms/richtext-lexical, @payloadcms/ui, graphql, sharp, sass, tsx
- Scripts added: generate:types, payload, seed
- Build passes successfully - no changes needed to existing codebase
- The seed script points to src/seed/index.ts which doesn't exist yet (will be created in S28)

Test Results:
- pnpm install: SUCCESS
- pnpm build: SUCCESS (compiled in 1163.4ms)

=== Iteration 2 - S2 - 2026-02-02 ===
Status: COMPLETE
Learnings:
- Moved all source directories (app, components, hooks, lib) to src/ using git mv to preserve history
- Created Payload-specific directories: collections/, globals/, blocks/, access/, utilities/, seed/, plugins/
- The empty features/ directory at root was removed (not tracked by git as empty)
- Updated tsconfig.json paths: @/* now resolves to ./src/*
- Updated components.json to point to src/app/globals.css for shadcn/ui
- The @/ alias imports in components (like @/lib/utils) continue to work after tsconfig.json update
- IMPORTANT: Must delete .next cache directory after directory restructure - stale type references cause build failures
- Added .gitkeep files to empty directories to ensure they are tracked by git
- All existing tests (13) continue to pass after restructure

Test Results:
- pnpm lint: SUCCESS
- pnpm typecheck: SUCCESS
- pnpm test: SUCCESS (13 tests in 3 files)
- pnpm build: SUCCESS (compiled in 1096.8ms)

Gotchas for future stories:
- Always clear .next cache when making structural changes to the project
- The @/* path alias must be updated in tsconfig.json when using src/ directory
- The components.json css path must also be updated for shadcn/ui to work correctly

=== Iteration 3 - S3 - 2026-02-02 ===
Status: COMPLETE
Learnings:
- Created src/payload.config.ts with Payload CMS 3.x buildConfig
- PostgreSQL adapter configured via DATABASE_URL environment variable (falls back to empty string for builds)
- Lexical rich text editor configured as the default editor
- Admin panel configured with meta title "Payload CMS Admin"
- TypeScript types output configured to src/payload-types.ts
- PAYLOAD_SECRET configured via environment variable with default fallback for development
- importMap configuration set with baseDir pointing to the dirname of the config file
- Used ESM-compatible path resolution with fileURLToPath and import.meta.url
- Build works without database connection - Payload handles missing DATABASE_URL gracefully during build
- All existing tests continue to pass (13 tests in 3 files)

Test Results:
- pnpm lint: SUCCESS
- pnpm typecheck: SUCCESS
- pnpm test: SUCCESS (13 tests in 3 files)
- pnpm build: SUCCESS (compiled in 1095.1ms)

Gotchas for future stories:
- The payload.config.ts uses ESM path resolution (fileURLToPath + import.meta.url) since the project has "type": "module"
- PAYLOAD_SECRET has a default value for development but should be set in production
- DATABASE_URL can be empty during builds - Payload handles this gracefully
- Future stories (S4) will need to integrate Payload routes into the Next.js app directory
- Collections and globals arrays are empty - will be populated in stories S5-S12 and S17

=== Iteration 4 - S4 - 2026-02-02 ===
Status: COMPLETE
Learnings:
- Created route groups: (payload) for admin/API routes and (frontend) for public pages
- Route groups use parentheses () in folder names - they don't affect URL structure
- Payload admin UI uses [[...segments]] catch-all route for dynamic admin pages
- REST API uses [[...slug]] catch-all route for all HTTP methods
- GraphQL endpoint uses separate route for GET (playground) and POST (queries)
- Must wrap Next.js config with withPayload from @payloadcms/next/withPayload
- Added @payload-config path alias to tsconfig.json for config imports
- Upgraded Next.js 16.0.10 -> 16.1.6 (Payload requires 16.1.0+ for Turbopack builds)
- Added pg package as explicit dependency for PostgreSQL support
- importMap.ts is auto-generated by Payload but needs initial stub file
- custom.scss file needed for admin panel custom styles
- @payloadcms/next/css import provides required admin panel styles
- components.json updated to point to (frontend)/globals.css for shadcn/ui

Route Structure:
- /admin/* → src/app/(payload)/admin/[[...segments]]/page.tsx
- /api/* → src/app/(payload)/api/[[...slug]]/route.ts
- /api/graphql → src/app/(payload)/api/graphql/route.ts
- /* (public) → src/app/(frontend)/page.tsx

Test Results:
- pnpm lint: SUCCESS
- pnpm typecheck: SUCCESS
- pnpm test: SUCCESS (13 tests in 3 files)
- pnpm build: SUCCESS

Gotchas for future stories:
- Route groups don't affect URL paths but allow separate layouts
- Payload generates importMap.ts during development/build - stub file needed initially
- withPayload wrapper is required for Next.js config
- Next.js version must be 16.1.0+ for Payload CMS compatibility
- pg package must be explicitly installed for PostgreSQL adapter

=== Iteration 5 - S5 - 2026-02-02 ===
Status: COMPLETE
Learnings:
- Created src/collections/Users/index.ts with Payload CollectionConfig
- Setting `auth: true` automatically adds email and password fields with authentication handling
- Role field implemented as select with options: admin, editor, user (defaultValue: 'user')
- Admin panel access control uses `admin.hidden` callback to hide from non-admin users
- Collection-level access control uses `access` object with read/create/update/delete/admin keys
- Access control functions receive `({ req: { user } })` to check authenticated user
- For conditional access (e.g., user can only read/update themselves), return a query object like `{ id: { equals: user.id } }`
- Field-level access control allows restricting who can update specific fields (e.g., only admins can change roles)
- TypeScript types are properly inferred from CollectionConfig - no manual type export needed
- Import Users collection and add to collections array in payload.config.ts

Test Results:
- pnpm lint: SUCCESS
- pnpm typecheck: SUCCESS
- pnpm test: SUCCESS (13 tests in 3 files)
- pnpm build: SUCCESS (compiled in 6.4s)

Gotchas for future stories:
- When `auth: true`, email and password fields are automatically provided - don't add them manually
- Access control queries use Payload's query syntax (e.g., `{ field: { equals: value } }`)
- The `admin` access key controls access to the admin panel for this collection specifically
- Future collections (Media, Pages, Posts, Categories) will follow similar patterns
- S18 will create reusable access control functions - for now, inline functions work fine

=== Iteration 6 - S6 - 2026-02-02 ===
Status: COMPLETE
Learnings:
- Created src/collections/Media.ts with Payload CollectionConfig for file uploads
- Upload configuration uses `upload` key with mimeTypes, imageSizes, and adminThumbnail
- mimeTypes filter restricts uploads to images: jpeg, png, gif, webp, svg+xml
- imageSizes array defines responsive image sizes with name, width, height, position
- Three image sizes configured: thumbnail (400x300), card (768x576), hero (1920x1080)
- position: 'centre' crops from center when resizing
- adminThumbnail: 'thumbnail' tells admin panel which size to use in list views
- Fields added: alt (text, required), caption (text, optional)
- Access control: public read, authenticated create/update, admin-only delete
- Media collection is simple (single file) - no subdirectory like Users collection

Test Results:
- pnpm lint: SUCCESS
- pnpm typecheck: SUCCESS
- pnpm build: SUCCESS (compiled in 6.0s)

Gotchas for future stories:
- Upload collections need `upload` config object (not `auth` like Users)
- imageSizes names become available as sizes[name].url in the Media document
- The sharp package (installed in S1) handles image processing automatically
- Future blocks (S14 MediaBlock) will reference this collection for images
- S17 will register all collections including Media in payload.config.ts (already done here)

=== Iteration 7 - S7 - 2026-02-02 ===
Status: COMPLETE
Learnings:
- Created src/collections/Pages/index.ts with CollectionConfig for static pages
- Pages collection follows directory structure like Users (subdirectory with index.ts)
- Fields implemented: title, slug (unique, indexed), publishedAt, hero group, layout blocks, meta group
- Hero group includes type (select), heading, subheading, media (upload to Media), richText
- Layout field is blocks array - currently empty, will be populated as blocks are created in S13-S16
- Meta group for SEO includes title, description, image (upload to Media)
- Slug generation hook using FieldHook on beforeValidate - converts title to URL-friendly slug
- Revalidation hook using CollectionAfterChangeHook - logs revalidation (actual Next.js revalidatePath requires runtime)
- Admin preview function returns URL based on slug (handles 'home' special case)
- Versions with drafts enabled for draft/publish workflow
- Access control: published pages are public (using _status equals 'published' query)
- Admin condition callbacks hide/show fields based on hero type selection

Test Results:
- pnpm lint: SUCCESS
- pnpm typecheck: SUCCESS
- pnpm build: SUCCESS (compiled in 5.7s)

Gotchas for future stories:
- The layout blocks array is empty - will be populated as Content, MediaBlock, CallToAction blocks are created
- FieldHook for slug uses beforeValidate to format before save
- For conditional field visibility in admin, use admin.condition callback with siblingData
- Upload fields use relationTo to specify the upload collection (e.g., 'media')
- Draft/publish uses versions.drafts: true and _status field is auto-managed by Payload
- Public read access for published pages uses query: { _status: { equals: 'published' } }
- S8 (Posts) will follow similar pattern with additional author and categories relationships
